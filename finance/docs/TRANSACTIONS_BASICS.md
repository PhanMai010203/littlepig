# Transactions: Basic Operations

This guide covers the fundamental Create, Read, Update, and Delete (CRUD) operations for managing transactions in the system.

## Basic Setup

```dart
import 'package:finance/features/transactions/domain/repositories/transaction_repository.dart';
import 'package:finance/features/transactions/domain/entities/transaction.dart';
import 'package:finance/features/categories/domain/repositories/category_repository.dart';
import 'package:finance/features/accounts/domain/repositories/account_repository.dart';
import 'package:finance/core/di/injection.dart';

// Get the repositories
final transactionRepository = getIt<TransactionRepository>();
final categoryRepository = getIt<CategoryRepository>();
final accountRepository = getIt<AccountRepository>();
```

## Retrieving Transactions

### Get All Transactions
```dart
// Get all transactions in the system
final transactions = await transactionRepository.getAllTransactions();
print('Found ${transactions.length} transactions');
```

### Get Transactions by Account
```dart
// Get all transactions for a specific account
final accountTransactions = await transactionRepository.getTransactionsByAccount(accountId);
```

### Get Transactions by Category
```dart
// Get all transactions for a specific category
final categoryTransactions = await transactionRepository.getTransactionsByCategory(categoryId);
```

### Get Transactions by Date Range
```dart
// Get transactions within a specific date range
final startDate = DateTime(2024, 1, 1);
final endDate = DateTime(2024, 12, 31);
final dateRangeTransactions = await transactionRepository.getTransactionsByDateRange(
  startDate,
  endDate,
);
```

### Get Transactions by Month (Paginated & Cached)
```dart
// Fetch March 2025 transactions – page 0 (first 25 items)
final marchTransactions = await transactionRepository.getTransactionsByMonth(
  year: 2025,
  month: 3,   // 1 = January … 12 = December
  page: 0,    // Zero-based page index
  limit: 25,  // Page size
);

// Fetch the next page
final moreMarch = await transactionRepository.getTransactionsByMonth(
  year: 2025,
  month: 3,
  page: 1,
  limit: 25,
);
```
The method performs **server-side filtering** at the SQL level and returns only the rows that fall within the given month boundary. Results are automatically cached for **3 minutes** using month-specific cache keys (e.g. `getTransactionsByMonth_2025_03_page_0_limit_25`).

> **Tip:** Always start with `page = 0`; stop paging when the returned list length is less than `limit`.

### Get Specific Transaction
```dart
// Get transaction by ID
final transaction = await transactionRepository.getTransactionById(transactionId);
if (transaction != null) {
  print('Transaction: ${transaction.title} - ${transaction.amount}');
}

// Get transaction by sync ID (for sync operations)
final syncTransaction = await transactionRepository.getTransactionBySyncId(syncId);
```

## Creating Transactions

### Basic Transaction Creation with Notes
```dart
// Create a new expense transaction with note
final expense = Transaction(
  title: 'Lunch at Restaurant',
  note: 'Had lunch with colleagues at downtown restaurant - Remember to expense this for the client meeting',
  amount: -25.50, // Negative for expenses
  categoryId: foodCategoryId,
  accountId: mainAccountId,
  date: DateTime.now(),
  createdAt: DateTime.now(),
  updatedAt: DateTime.now(),
  syncId: '', // Will be generated by repository
);

final createdTransaction = await transactionRepository.createTransaction(expense);
print('Created transaction with ID: ${createdTransaction.id}');
```

### Create Income Transaction
```dart
// Create a new income transaction
final income = Transaction(
  title: 'Monthly Salary',
  note: 'Salary payment from company - Includes bonus for Q4 performance',
  amount: 3500.00, // Positive for income
  categoryId: salaryCategoryId,
  accountId: bankAccountId,
  date: DateTime.now(),
  createdAt: DateTime.now(),
  updatedAt: DateTime.now(),
  syncId: '',
);

final createdIncome = await transactionRepository.createTransaction(income);
```

### Create Transaction with Full Details
```dart
// Create transaction with all optional fields
final detailedTransaction = Transaction(
  title: 'Grocery Shopping',
  note: 'Weekly grocery shopping at SuperMart\\nItems: milk, bread, fruits\\nUsed 10% discount coupon - saved $8.50',
  amount: -85.75,
  categoryId: groceryCategoryId,
  accountId: creditCardAccountId,
  date: DateTime(2024, 6, 15, 14, 30), // Specific date and time
  createdAt: DateTime.now(),
  updatedAt: DateTime.now(),
  syncId: '',
);

await transactionRepository.createTransaction(detailedTransaction);
```

## Updating Transactions

### Basic Update with Notes
```dart
// Update an existing transaction
final updatedTransaction = existingTransaction.copyWith(
  title: 'Updated Title',
  amount: -30.00,
  note: 'Updated notes with additional information about this transaction',
);

final result = await transactionRepository.updateTransaction(updatedTransaction);
```

### Update Category or Account
```dart
// Move transaction to different category or account
final recategorized = transaction.copyWith(
  categoryId: newCategoryId,
  accountId: newAccountId,
  note: 'Recategorized from ${oldCategoryName} to ${newCategoryName}',
);

await transactionRepository.updateTransaction(recategorized);
```

### Update Amount
```dart
// Correct transaction amount
final correctedAmount = transaction.copyWith(
  amount: -45.99, // Corrected amount
  note: 'Corrected amount from original ${transaction.amount}',
);

await transactionRepository.updateTransaction(correctedAmount);
```

## Deleting Transactions

### Delete Transaction and Its Attachments
This example shows how to delete a transaction and its associated attachments. You should manage attachments separately. See the Attachments guide for more details.
```dart
// Get all attachments for the transaction first
final attachments = await attachmentRepository.getAttachmentsByTransaction(transactionId);

// Delete all attachments (moves files to Google Drive trash)
for (final attachment in attachments) {
  await filePickerService.deleteAttachment(attachment.id!);
}

// Delete the transaction
await transactionRepository.deleteTransaction(transactionId);
```

## Transaction Properties

### Check Transaction Type
```dart
// Use built-in properties to check transaction type
if (transaction.isIncome) {
  print('This is an income transaction');
}

if (transaction.isExpense) {
  print('This is an expense transaction');
}

// Manual check
if (transaction.amount > 0) {
  print('Income: +${transaction.amount}');
} else {
  print('Expense: ${transaction.amount}');
}
```

### Access Transaction Details
```dart
// Access all transaction properties including notes
print('ID: ${transaction.id}');
print('Title: ${transaction.title}');
print('Note: ${transaction.note ?? 'No additional notes'}');
print('Amount: ${transaction.amount}');
print('Date: ${transaction.date}');
print('Created: ${transaction.createdAt}');
print('Updated: ${transaction.updatedAt}');
print('Category ID: ${transaction.categoryId}');
print('Account ID: ${transaction.accountId}');
print('Sync ID: ${transaction.syncId}');
``` 